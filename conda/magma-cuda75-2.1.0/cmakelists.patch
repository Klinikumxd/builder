--- /home/soumith/code/magma/magma-2.1.0/CMakeLists.txt	2016-08-30 06:37:45.000000000 -0700
+++ CMakeLists.txt	2016-09-12 18:20:23.896132434 -0700
@@ -166,11 +166,18 @@
 		message( STATUS "    compile for CUDA arch 5.0 (Maxwell)" )
 	endif()
 	
+        if ( ${GPU_TARGET} MATCHES "All")
+          set( MIN_ARCH 200)
+          SET( NV_SM "-gencode arch=compute_20,code=sm_20 -gencode arch=compute_20,code=sm_21 -gencode arch=compute_30,code=sm_30 -gencode arch=compute_35,code=sm_35 -gencode arch=compute_50,code=sm_50 -gencode arch=compute_52,code=sm_52 -gencode arch=compute_32,code=sm_32 -gencode arch=compute_37,code=sm_37 -gencode arch=compute_53,code=sm_53")
+          SET( NV_COMP "")
+        endif()
+
 	if ( NOT MIN_ARCH )
 		message( FATAL_ERROR "GPU_TARGET must contain one or more of Fermi, Kepler, Maxwell, or sm{20,30,35,50}." )
 	endif()
 	
 	set( CUDA_NVCC_FLAGS "${CUDA_NVCC_FLAGS} -DHAVE_CUBLAS ${NV_SM} ${NV_COMP} ${FORTRAN_CONVENTION}" )
+        MESSAGE(STATUS "CUDA_NVCC_FLAGS: ${CUDA_NVCC_FLAGS}")
 	add_definitions( "-DHAVE_CUBLAS -DMIN_CUDA_ARCH=${MIN_ARCH}" )
 	message( STATUS "Define -DHAVE_CUBLAS -DMIN_CUDA_ARCH=${MIN_ARCH}" )
 endif()
